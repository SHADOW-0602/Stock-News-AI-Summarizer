<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock News AI Summarizer</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Header Section -->
    <header class="main-header">
        <nav class="navbar">
            <div class="nav-brand">
                <h1>Stock News</h1>
            </div>
            <div class="nav-links">
                <a href="/features">Features</a>
                <a href="/about">About</a>
                <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <video class="hero-video" autoplay muted loop>
            <source src="{{ url_for('static', filename='Herosection.mp4') }}" type="video/mp4">
        </video>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <div class="hero-badge">AI-Powered Financial Intelligence Platform</div>
            <h1 class="hero-title">Revolutionize Your Trading with AI-Powered Stock News Analysis</h1>
            <p class="hero-description">Experience the future of trading with our cutting-edge AI that analyzes
                thousands of news sources, market trends, and financial data to deliver precise trading signals and
                comprehensive stock summaries.</p>
            <div class="hero-buttons">
                <button class="btn-primary"
                    onclick="document.getElementById('ticker-input').scrollIntoView({behavior: 'smooth'}); document.getElementById('ticker-input').focus();">Get
                    Started Free</button>
                <button class="btn-secondary">View Live Demo</button>
            </div>
            <div class="hero-stats">
                <div class="stat">
                    <span class="stat-number">15+</span>
                    <span class="stat-label">News Sources</span>
                </div>
                <div class="stat">
                    <span class="stat-number">95%</span>
                    <span class="stat-label">Accuracy Rate</span>
                </div>
                <div class="stat">
                    <span class="stat-number">24/7</span>
                    <span class="stat-label">Market Monitoring</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="features-header">
            <h2>Powerful AI Trading Features</h2>
            <p>Everything you need to make smarter trading decisions</p>
        </div>
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon-large"><img src="" data-pexels="newspaper financial news" alt="News"
                        style="width: 60px; height: 60px; border-radius: 8px;"></div>
                <h3>Multi-Source News Analysis</h3>
                <p>AI processes news from 15+ premium sources including TradingView, Benzinga, Reuters, and more to
                    deliver comprehensive market insights</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon-large"><img src="" data-pexels="artificial intelligence robot" alt="AI"
                        style="width: 60px; height: 60px; border-radius: 8px;"></div>
                <h3>Gemini AI Summaries</h3>
                <p>Advanced AI curates and summarizes the most relevant news articles, highlighting key market-moving
                    events and trading opportunities</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon-large"><img src="" data-pexels="stock market chart graph" alt="Charts"
                        style="width: 60px; height: 60px; border-radius: 8px;"></div>
                <h3>Real-Time Price Charts</h3>
                <p>Interactive charts with multiple timeframes, technical indicators, and price predictions powered by
                    machine learning algorithms</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon-large"><img src="" data-pexels="target bullseye accuracy" alt="Target"
                        style="width: 60px; height: 60px; border-radius: 8px;"></div>
                <h3>Sentiment Analysis</h3>
                <p>NLP-powered sentiment scoring from news headlines and content to gauge market mood and predict price
                    movements</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon-large"><img src="" data-pexels="magnifying glass search" alt="Search"
                        style="width: 60px; height: 60px; border-radius: 8px;"></div>
                <h3>Entity Recognition</h3>
                <p>Automatically highlights financial metrics, company names, and key terms in summaries for quick
                    scanning and analysis</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon-large"><img src="" data-pexels="clock time speed" alt="Time"
                        style="width: 60px; height: 60px; border-radius: 8px;"></div>
                <h3>Smart Caching</h3>
                <p>8-hour news cache and 6-hour summary cache with 7-day logo storage for lightning-fast portfolio
                    management</p>
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="cta-section">
        <div class="cta-content">
            <h2>Ready to Transform Your Trading?</h2>
            <p>Join thousands of traders who are already using AI to make smarter investment decisions</p>
            <div class="cta-buttons">
                <button class="btn-primary">Start Trading with AI</button>
                <a href="/learn-more" class="btn-outline">Learn More</a>
            </div>
        </div>
    </section>

    <!-- Newsletter Subscription -->
    <section class="newsletter-section">
        <div class="newsletter-content">
            <h3>üìß Get Daily Stock Analysis Reports</h3>
            <p>Receive AI-powered stock summaries directly in your inbox every morning</p>
            <div class="newsletter-form">
                <input type="email" id="newsletter-email" placeholder="Enter your email address">
                <button id="subscribe-btn" onclick="subscribeNewsletter()">Subscribe Free</button>
            </div>
            <div id="newsletter-message" class="message"></div>
            <p class="newsletter-note">‚úÖ Free forever ‚Ä¢ üìä Weekly reports ‚Ä¢ üîí No spam</p>
        </div>
    </section>

    <!-- Add Ticker Section -->
    <section class="add-ticker-section">
        <h2>Add New Stock</h2>
        <div class="add-ticker-form">
            <input type="text" id="ticker-input" placeholder="Enter ticker symbol (e.g., AAPL)" maxlength="10">
            <button id="add-btn" onclick="addTicker()">Add Stock</button>
        </div>
        <div id="add-message" class="message"></div>
    </section>

    <!-- Supported Stocks -->
    <section class="stocks-section">
        <h2>Your Stock Portfolio</h2>
        <p>AI-powered analysis for your tracked stocks with real-time news aggregation and sentiment analysis</p>

        <div id="stocks-grid" class="stocks-grid">
            <div class="loading">Loading your stocks...</div>
        </div>
    </section>

    <script>
        // Load tickers from Supabase
        async function loadTickers() {
            try {
                const response = await fetch('/api/tickers');

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const tickers = await response.json();
                const stocksGrid = document.getElementById('stocks-grid');

                if (!Array.isArray(tickers)) {
                    throw new Error('Invalid response format');
                }

                if (tickers.length === 0) {
                    stocksGrid.innerHTML = '<p>No stocks added yet. Add some tickers to get started!</p>';
                    return;
                }

                // Load logos for each ticker
                const tickersWithLogos = await Promise.all(tickers.map(async (tickerData) => {
                    const symbol = typeof tickerData === 'string' ? tickerData : tickerData.symbol;
                    try {
                        const logoResponse = await fetch(`/api/logo/${symbol}`);
                        const logoData = logoResponse.ok ? await logoResponse.json() : null;
                        return {
                            symbol: symbol,
                            company_name: typeof tickerData === 'object' ? tickerData.company_name : null,
                            logoUrl: logoData?.image || null
                        };
                    } catch {
                        return {
                            symbol: symbol,
                            company_name: typeof tickerData === 'object' ? tickerData.company_name : null,
                            logoUrl: null
                        };
                    }
                }));

                stocksGrid.innerHTML = tickersWithLogos.map(ticker => `
                    <div class="stock-card">
                        <button class="remove-btn" onclick="removeTicker('${ticker.symbol}')">&times;</button>
                        <div class="stock-logo" onclick="viewStock('${ticker.symbol}')">
                            ${ticker.logoUrl ?
                        `<img src="${ticker.logoUrl}" alt="${ticker.symbol}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;">` :
                        `${ticker.symbol.charAt(0)}`
                    }
                        </div>
                        <h4 onclick="viewStock('${ticker.symbol}')">${ticker.symbol}</h4>
                        <p onclick="viewStock('${ticker.symbol}')">${ticker.company_name || ''}</p>

                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading tickers:', error);
                document.getElementById('stocks-grid').innerHTML = `<p>Error loading stocks: ${error.message}</p>`;
            }
        }

        function viewStock(symbol) {
            window.location.href = `/stock/${symbol}`;
        }

        async function addTicker() {
            const input = document.getElementById('ticker-input');
            const symbol = input.value.trim().toUpperCase();
            const message = document.getElementById('add-message');

            if (!symbol) {
                message.textContent = 'Please enter a ticker symbol';
                message.className = 'message error';
                return;
            }

            try {
                const response = await fetch('/api/tickers', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ticker: symbol })
                });

                if (response.ok) {
                    message.textContent = `${symbol} added successfully!`;
                    message.className = 'message success';
                    input.value = '';
                    loadTickers();
                } else {
                    const error = await response.json();
                    message.textContent = error.error || 'Failed to add ticker';
                    message.className = 'message error';
                }
            } catch (error) {
                message.textContent = 'Error adding ticker';
                message.className = 'message error';
            }
        }

        async function removeTicker(symbol) {
            if (!confirm(`Remove ${symbol} from your portfolio?`)) return;

            // Add removing animation
            const stockCards = document.querySelectorAll('.stock-card');
            const targetCard = Array.from(stockCards).find(card =>
                card.querySelector('h4').textContent === symbol
            );

            if (targetCard) {
                targetCard.classList.add('removing');
            }

            try {
                const response = await fetch(`/api/tickers/${symbol}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    // Wait for animation to complete before reloading
                    setTimeout(() => loadTickers(), 200);
                } else {
                    // Remove animation class if failed
                    if (targetCard) targetCard.classList.remove('removing');
                    alert('Failed to remove ticker');
                }
            } catch (error) {
                if (targetCard) targetCard.classList.remove('removing');
                alert('Error removing ticker');
            }
        }

        // Load Pexels images
        async function loadPexelsImage(query, imgElement) {
            try {
                const response = await fetch(`/api/pexels-image?query=${encodeURIComponent(query)}`);
                if (response.ok) {
                    const data = await response.json();
                    if (data.image) {
                        imgElement.src = data.image;
                    }
                }
            } catch (error) {
                console.log('Pexels image load failed:', error);
            }
        }

        // Initialize Pexels images
        function initPexelsImages() {
            document.querySelectorAll('[data-pexels]').forEach(img => {
                const query = img.getAttribute('data-pexels');
                loadPexelsImage(query, img);
            });


        }



        // Load tickers when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadTickers();
            initPexelsImages();
        });

        // Add ticker on Enter key
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('ticker-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTicker();
            });

            // Newsletter subscription on Enter
            document.getElementById('newsletter-email').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') subscribeNewsletter();
            });
        });

        // Newsletter subscription function
        async function subscribeNewsletter() {
            const emailInput = document.getElementById('newsletter-email');
            const message = document.getElementById('newsletter-message');
            const email = emailInput.value.trim();

            if (!email || !email.includes('@')) {
                message.textContent = 'Please enter a valid email address';
                message.className = 'message error';
                return;
            }

            try {
                const response = await fetch('/api/subscribe', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                });

                if (response.ok) {
                    message.textContent = 'üéâ Successfully subscribed! Check your inbox for daily reports.';
                    message.className = 'message success';
                    emailInput.value = '';
                    setTimeout(() => {
                        message.textContent = '';
                        message.className = 'message';
                    }, 2000);
                } else {
                    const error = await response.json();
                    message.textContent = error.error || 'Subscription failed';
                    message.className = 'message error';
                }
            } catch (error) {
                message.textContent = 'Network error. Please try again.';
                message.className = 'message error';
            }
        }
    </script>

    <script>
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const toggle = document.querySelector('.theme-toggle');
            toggle.textContent = document.body.classList.contains('light-mode') ? '‚òÄÔ∏è' : 'üåô';
        }
    </script>


</body>

</html>